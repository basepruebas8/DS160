<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal 11</title>
  <style>
    :root{
      color-scheme: light dark;
      --bg: #f6f7fb;
      --bg-grad: radial-gradient(1200px 600px at 10% -10%, #dfe7ff55, transparent 60%),
                 radial-gradient(800px 400px at 110% 10%, #ffe6d655, transparent 60%);
      --card: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --border: #e2e8f0;
      --accent: #2563eb;
      --accent-600: #1d4ed8;
      --accent-700: #1e40af;
      --ring: #93c5fd;
      --shadow: 0 10px 30px rgba(2, 8, 23, .08);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg: #0b1220;
        --bg-grad: radial-gradient(1200px 600px at 10% -10%, #1d2a4e75, transparent 60%),
                   radial-gradient(800px 400px at 110% 10%, #4e2a1d75, transparent 60%);
        --card: #0f172a;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --border: #233044;
        --accent: #60a5fa;
        --accent-600: #3b82f6;
        --accent-700: #2563eb;
        --ring: #60a5fa;
        --shadow: 0 12px 36px rgba(0,0,0,.35);
      }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      line-height: 1.45;
      color: var(--text);
      background: var(--bg);
      background-image: var(--bg-grad);
    }

    .wrap { max-width: 960px; margin: 32px auto; padding: 0 16px; }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      box-shadow: var(--shadow);
      backdrop-filter: saturate(120%) blur(4px);
    }

    header h1 { font-size: 1.35rem; margin: 0 0 6px; letter-spacing: -.01em; }
    .subtle { color: var(--muted); font-size: .95rem; margin-bottom: 18px; }

    fieldset {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      margin: 16px 0;
      background: linear-gradient(180deg, rgba(148,163,184,.06), transparent 60%);
    }
    legend { font-weight: 700; padding: 0 10px; font-size: .98rem; }
    legend::after{
      content: ""; display: inline-block; width: 8px; height: 8px; margin-left: 8px; border-radius: 999px;
      background: var(--accent); box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent) 20%, transparent);
    }

    label { display: inline-block; margin: 8px 0 6px; font-weight: 600; }
    .row { display: grid; grid-template-columns: 1fr; gap: 10px; }
    .grid-2 { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; }
    .inline { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .inline.nowrap { flex-wrap: nowrap; }

    input[type="text"], textarea, select {
      width: 100%; max-width: 560px; padding: 10px 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text);
      outline: none; transition: border-color .15s ease, box-shadow .15s ease, transform .06s ease; box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    }
    /* VISUAL: mostrar el texto en MAYÚSCULAS */
    input[type="text"], textarea { text-transform: uppercase; }
    textarea { min-height: 90px; resize: vertical; }
    input[type="text"]:focus, textarea:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px color-mix(in oklab, var(--ring) 45%, transparent); }
    select.small { max-width: 420px; }

    .help { font-size: .9rem; color: var(--muted); margin-top: 2px; }
    .note { font-size:.92rem; color:var(--muted); }

    .actions { margin-top: 18px; display: flex; gap: 12px; align-items: center; border-top: 1px dashed var(--border); padding-top: 16px; }
    button {
      padding: 10px 16px; border-radius: 12px; border: 1px solid var(--border); background: var(--card);
      cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-weight: 600;
      transition: transform .06s ease, box-shadow .15s ease, background .2s ease, border-color .15s ease;
    }
    button.primary { background: linear-gradient(180deg, var(--accent), var(--accent-600)); color: white; border-color: transparent; box-shadow: 0 6px 16px rgba(37,99,235,.35); }
    button.primary:hover { background: linear-gradient(180deg, var(--accent-600), var(--accent-700)); transform: translateY(-0.5px); }

    .list-item { display:flex; gap:12px; align-items:center; }
    .list-item button.remove { border-color:#ef4444; color:#ef4444; }
    .list-item button.remove:hover{ background:#ef44441a; }

    [hidden] { display: none !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Solicitud de Visa de No Inmigrante en línea (DS-160)</h1>
        <div class="subtle">Sección: <strong>Trabajo / Educación / Capacitación — Información adicional</strong></div>
      </header>

      <form id="ds160-work-edu-3" action="#" method="post" novalidate>
        <fieldset>
          <legend>Información adicional</legend>
          <p class="help">Nota: Proporcione la siguiente información relacionada con su trabajo, educación o capacitación. Brinde información completa y precisa a todas las preguntas que requieran explicación.</p>

          <!-- Clan / tribu -->
          <div class="row">
            <label>¿Pertenece a algún clan o tribu?</label>
            <div class="inline" role="radiogroup" aria-label="Pertenencia a clan o tribu">
              <label style="font-weight:400;"><input type="radio" name="CLAN_TRIBE_IND" value="Y" id="CLAN_TRIBE_IND_Y" required> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="CLAN_TRIBE_IND" value="N" id="CLAN_TRIBE_IND_N" checked> No</label>
            </div>
          </div>

          <!-- Idiomas que habla -->
          <div class="row" style="margin-top:8px;">
            <label for="LANGUAGE_0">Proporcione una lista de idiomas que habla</label>
            <div id="langList" class="row"></div>
            <div class="inline">
              <button type="button" id="addLangBtn">Agregar otro idioma</button>
            </div>
            <p class="help">Ejemplo: ESPAÑOL, INGLÉS, FRANCÉS.</p>
          </div>

          <!-- Países visitados últimos 5 años -->
          <div class="row" style="margin-top:8px;">
            <label>¿Ha viajado a algún país o región en los últimos cinco años?</label>
            <div class="inline" role="radiogroup" aria-label="Países visitados últimos 5 años">
              <label style="font-weight:400;"><input type="radio" name="COUNTRIES_VISITED_IND" value="Y" id="COUNTRIES_VISITED_Y" required> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="COUNTRIES_VISITED_IND" value="N" id="COUNTRIES_VISITED_N" checked> No</label>
            </div>
          </div>

          <div id="countriesSection" class="row" hidden>
            <label for="VISITED_COUNTRY_0">Lista de países/regiones visitados</label>
            <div id="countryList" class="row"></div>
            <div class="inline">
              <button type="button" id="addCountryBtn">Agregar otro país</button>
            </div>
            <p class="help">Escriba el nombre oficial del país o región. Ejemplo: ESTADOS UNIDOS, CANADÁ, JAPÓN.</p>
          </div>

          <!-- Organizaciones -->
          <div class="row" style="margin-top:8px;">
            <label>¿Ha pertenecido, contribuido o trabajado para alguna organización profesional, social o caritativa?</label>
            <div class="inline" role="radiogroup" aria-label="Organizaciones">
              <label style="font-weight:400;"><input type="radio" name="ORGANIZATION_IND" value="Y" id="ORGANIZATION_IND_Y" required> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="ORGANIZATION_IND" value="N" id="ORGANIZATION_IND_N" checked> No</label>
            </div>
          </div>

          <!-- Habilidades especializadas -->
          <div class="row" style="margin-top:8px;">
            <label>¿Cuenta con habilidades o capacitación especializada, como armas de fuego, explosivos, experiencia nuclear, biológica o química?</label>
            <div class="inline" role="radiogroup" aria-label="Habilidades especializadas">
              <label style="font-weight:400;"><input type="radio" name="SPECIALIZED_SKILLS_IND" value="Y" id="SPECIALIZED_SKILLS_Y" required> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="SPECIALIZED_SKILLS_IND" value="N" id="SPECIALIZED_SKILLS_N" checked> No</label>
            </div>
          </div>

          <div id="skillsExplain" class="row" hidden>
            <label for="SPECIALIZED_SKILLS_EXPL">Explique</label>
            <textarea id="SPECIALIZED_SKILLS_EXPL" name="SPECIALIZED_SKILLS_EXPL" maxlength="4000" placeholder="DESCRIBA SUS HABILIDADES O CAPACITACIÓN."></textarea>
          </div>

          <!-- Servicio militar -->
          <div class="row" style="margin-top:8px;">
            <label>¿Ha servido alguna vez en las fuerzas armadas?</label>
            <div class="inline" role="radiogroup" aria-label="Servicio militar">
              <label style="font-weight:400;"><input type="radio" name="MILITARY_SERVICE_IND" value="Y" id="MILITARY_SERVICE_Y" required> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="MILITARY_SERVICE_IND" value="N" id="MILITARY_SERVICE_N" checked> No</label>
            </div>
          </div>

          <!-- Insurgente / paramilitar -->
          <div class="row" style="margin-top:8px;">
            <label>¿Ha servido en, sido miembro de o participado con una unidad paramilitar, unidad de vigilancia, grupo rebelde, guerrilla u organización insurgente?</label>
            <div class="inline" role="radiogroup" aria-label="Organizaciones insurgentes">
              <label style="font-weight:400;"><input type="radio" name="INSURGENT_ORG_IND" value="Y" id="INSURGENT_ORG_Y" required> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="INSURGENT_ORG_IND" value="N" id="INSURGENT_ORG_N" checked> No</label>
            </div>
          </div>

          <div id="insurgentExplain" class="row" hidden>
            <label for="INSURGENT_ORG_EXPL">Explique</label>
            <textarea id="INSURGENT_ORG_EXPL" name="INSURGENT_ORG_EXPL" maxlength="4000" placeholder="PROPORCIONE DETALLES."></textarea>
          </div>
        </fieldset>

        <div class="actions">
          <button type="button" id="backBtn">Regresar</button>
          <button type="button" id="nextBtn" class="primary">Siguiente</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Navegación
    const NEXT_URL = new URL('personal12.html', window.location.href).href;
    const BACK_URL = new URL('personal10.html', window.location.href).href;

    // Persistencia
    const STORAGE_PREFIX = 'ds160:';
    const FORM_ID = 'ds160-work-edu-3';

    function storageKey(field) {
      const idOrName = field.type === 'radio' ? field.name : (field.id || field.name);
      return STORAGE_PREFIX + FORM_ID + ':' + idOrName;
    }
    function saveField(field) {
      try {
        if (field.type === 'radio') {
          if (field.checked) localStorage.setItem(storageKey(field), field.value);
        } else if (field.type === 'checkbox') {
          localStorage.setItem(storageKey(field), field.checked ? '1' : '0');
        } else {
          // GUARDAR EN MAYÚSCULAS
          localStorage.setItem(storageKey(field), (field.value || '').toUpperCase());
        }
      } catch(e) {}
    }
    function restoreField(field) {
      try {
        const key = storageKey(field);
        const v = localStorage.getItem(key);
        if (v == null) return;
        if (field.type === 'radio') {
          field.checked = (field.value === v);
        } else if (field.type === 'checkbox') {
          field.checked = (v === '1');
        } else {
          field.value = v.toUpperCase();
        }
      } catch(e) {}
    }
    function autosave(form) {
      form.addEventListener('input', (e) => {
        const t = e.target;
        if (!(t instanceof HTMLElement)) return;
        if (t.matches('input[type="text"], textarea')) {
          // FORZAR MAYÚSCULAS EN TIEMPO REAL
          t.value = t.value.toUpperCase();
        }
        if (t.matches('input,select,textarea')) saveField(t);
      }, true);
      form.addEventListener('change', (e) => {
        const t = e.target;
        if (!(t instanceof HTMLElement)) return;
        if (t.matches('input[type="text"], textarea')) {
          t.value = t.value.toUpperCase();
        }
        if (t.matches('input,select,textarea')) saveField(t);
      }, true);
      // Manejar pegado (por si el navegador no dispara input adecuadamente)
      form.addEventListener('paste', (e) => {
        const t = e.target;
        if (t && (t.matches('input[type="text"], textarea'))) {
          setTimeout(() => {
            t.value = t.value.toUpperCase();
            saveField(t);
          }, 0);
        }
      }, true);
    }
    function restoreForm(form) {
      const fields = form.querySelectorAll('input,select,textarea');
      fields.forEach(f => restoreField(f));
    }

    const form = document.getElementById('ds160-work-edu-3');

    // ----- Idiomas -----
    const LANG_COUNT_KEY = STORAGE_PREFIX + FORM_ID + ':LANG_COUNT';
    const langList = document.getElementById('langList');
    const addLangBtn = document.getElementById('addLangBtn');

    function langCount(){
      const v = parseInt(localStorage.getItem(LANG_COUNT_KEY) || '1', 10);
      return Number.isFinite(v) && v > 0 ? v : 1;
    }
    function setLangCount(n){
      localStorage.setItem(LANG_COUNT_KEY, String(Math.max(1, n)));
    }
    function makeLangItem(index){
      const wrap = document.createElement('div');
      wrap.className = 'list-item';

      const input = document.createElement('input');
      input.type = 'text';
      input.id = `LANGUAGE_${index}`;
      input.name = `LANGUAGE_${index}`;
      input.maxLength = 66;
      input.placeholder = 'EJ. ESPAÑOL';
      input.required = (index === 0);

      const remove = document.createElement('button');
      remove.type = 'button';
      remove.className = 'remove';
      remove.textContent = 'Eliminar';
      remove.addEventListener('click', () => {
        langList.removeChild(wrap);
        reindexLangItems();
        setLangCount(langList.children.length);
      });

      wrap.appendChild(input);
      wrap.appendChild(remove);
      return wrap;
    }
    function reindexLangItems(){
      [...langList.children].forEach((item, i) => {
        const input = item.querySelector('input');
        input.id = `LANGUAGE_${i}`;
        input.name = `LANGUAGE_${i}`;
        input.required = (i === 0);
      });
      refreshLangRemoveButtons();
    }
    function refreshLangRemoveButtons(){
      const items = [...langList.children];
      items.forEach((item) => {
        const btn = item.querySelector('button.remove');
        btn.hidden = items.length <= 1;
      });
    }
    function addLanguage(){
      const idx = langList.children.length;
      const item = makeLangItem(idx);
      langList.appendChild(item);
      setLangCount(langList.children.length);
    }
    addLangBtn.addEventListener('click', addLanguage);

    (function initLangFromStorage(){
      const count = langCount();
      for (let i=0; i<count; i++){
        const item = makeLangItem(i);
        langList.appendChild(item);
      }
      [...langList.querySelectorAll('input')].forEach(inp => restoreField(inp));
      refreshLangRemoveButtons();
    })();

    // ----- Países visitados -----
    const countryList = document.getElementById('countryList');
    const addCountryBtn = document.getElementById('addCountryBtn');
    const COUNTRIES_COUNT_KEY = STORAGE_PREFIX + FORM_ID + ':COUNTRIES_COUNT';

    function countriesCount(){
      const v = parseInt(localStorage.getItem(COUNTRIES_COUNT_KEY) || '1', 10);
      return Number.isFinite(v) && v > 0 ? v : 1;
    }
    function setCountriesCount(n){
      localStorage.setItem(COUNTRIES_COUNT_KEY, String(Math.max(1, n)));
    }
    function makeCountryItem(index){
      const wrap = document.createElement('div');
      wrap.className = 'list-item';

      const input = document.createElement('input');
      input.type = 'text';
      input.id = `VISITED_COUNTRY_${index}`;
      input.name = `VISITED_COUNTRY_${index}`;
      input.maxLength = 64;
      input.placeholder = 'EJ. ESTADOS UNIDOS';
      input.required = true;

      const remove = document.createElement('button');
      remove.type = 'button';
      remove.className = 'remove';
      remove.textContent = 'Eliminar';
      remove.addEventListener('click', () => {
        countryList.removeChild(wrap);
        reindexCountryItems();
        setCountriesCount(countryList.children.length);
      });

      wrap.appendChild(input);
      wrap.appendChild(remove);
      return wrap;
    }
    function reindexCountryItems(){
      [...countryList.children].forEach((item, i) => {
        const input = item.querySelector('input');
        input.id = `VISITED_COUNTRY_${i}`;
        input.name = `VISITED_COUNTRY_${i}`;
      });
      refreshCountryRemoveButtons();
    }
    function refreshCountryRemoveButtons(){
      const items = [...countryList.children];
      items.forEach((item) => {
        const btn = item.querySelector('button.remove');
        btn.hidden = items.length <= 1;
      });
    }
    function addCountry(){
      const idx = countryList.children.length;
      const item = makeCountryItem(idx);
      countryList.appendChild(item);
      setCountriesCount(countryList.children.length);
    }
    addCountryBtn.addEventListener('click', addCountry);

    const COUNTRIES_Y = document.getElementById('COUNTRIES_VISITED_Y');
    const COUNTRIES_N = document.getElementById('COUNTRIES_VISITED_N');
    const countriesSection = document.getElementById('countriesSection');

    function updateCountriesSection(){
      const show = COUNTRIES_Y.checked;
      countriesSection.hidden = !show;
      [...countryList.querySelectorAll('input')].forEach(inp => inp.required = show);
    }

    (function initCountriesFromStorage(){
      const count = countriesCount();
      for (let i=0; i<count; i++){
        const item = makeCountryItem(i);
        countryList.appendChild(item);
      }
      [...countryList.querySelectorAll('input')].forEach(inp => restoreField(inp));
      refreshCountryRemoveButtons();
    })();

    [COUNTRIES_Y, COUNTRIES_N].forEach(r => r.addEventListener('change', () => {
      saveField(r);
      updateCountriesSection();
    }));

    // ----- Habilidades especializadas -----
    const SKILLS_Y = document.getElementById('SPECIALIZED_SKILLS_Y');
    const SKILLS_N = document.getElementById('SPECIALIZED_SKILLS_N');
    const skillsExplain = document.getElementById('skillsExplain');
    const SKILLS_EXPL = document.getElementById('SPECIALIZED_SKILLS_EXPL');

    function updateSkills(){
      const show = SKILLS_Y.checked;
      skillsExplain.hidden = !show;
      SKILLS_EXPL.required = show;
      if (!show) SKILLS_EXPL.setCustomValidity('');
    }
    [SKILLS_Y, SKILLS_N].forEach(r => r.addEventListener('change', () => {
      saveField(r);
      updateSkills();
    }));

    // ----- Insurgente / paramilitar -----
    const INS_Y = document.getElementById('INSURGENT_ORG_Y');
    const INS_N = document.getElementById('INSURGENT_ORG_N');
    const insurgentExplain = document.getElementById('insurgentExplain');
    const INS_EXPL = document.getElementById('INSURGENT_ORG_EXPL');

    function updateInsurgent(){
      const show = INS_Y.checked;
      insurgentExplain.hidden = !show;
      INS_EXPL.required = show;
      if (!show) INS_EXPL.setCustomValidity('');
    }
    [INS_Y, INS_N].forEach(r => r.addEventListener('change', () => {
      saveField(r);
      updateInsurgent();
    }));

    // Restaurar y activar autosave
    restoreForm(form);
    autosave(form);

    // Estado inicial de secciones ocultas
    updateCountriesSection();
    updateSkills();
    updateInsurgent();

    // Validación mínima antes de avanzar
    function checkForm(){
      const firstLang = document.getElementById('LANGUAGE_0');
      if (firstLang && !firstLang.value.trim()){
        firstLang.setCustomValidity('INDIQUE AL MENOS UN IDIOMA.');
      } else if (firstLang){
        firstLang.setCustomValidity('');
      }
      if (skillsExplain.hidden) SKILLS_EXPL.setCustomValidity('');
      if (insurgentExplain.hidden) INS_EXPL.setCustomValidity('');

      return form.checkValidity();
    }

    // Navegación
    document.getElementById('backBtn').addEventListener('click', () => {
      form.querySelectorAll('input,select,textarea').forEach(saveField);
      window.location.assign(BACK_URL);
    });
    document.getElementById('nextBtn').addEventListener('click', () => {
      if (!checkForm()){
        form.reportValidity();
        const firstInvalid = form.querySelector(':invalid');
        if (firstInvalid) firstInvalid.scrollIntoView({behavior:'smooth', block:'center'});
        return;
      }
      form.querySelectorAll('input,select,textarea').forEach(saveField);
      window.location.assign(NEXT_URL);
    });
  </script>
</body>
</html>
