<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal 6</title>
  <style>
    :root{
      color-scheme: light dark;
      --bg: #f6f7fb;
      --bg-grad: radial-gradient(1200px 600px at 10% -10%, #dfe7ff55, transparent 60%),
                 radial-gradient(800px 400px at 110% 10%, #ffe6d655, transparent 60%);
      --card: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --border: #e2e8f0;
      --accent: #2563eb;
      --accent-600: #1d4ed8;
      --accent-700: #1e40af;
      --ring: #93c5fd;
      --shadow: 0 10px 30px rgba(2, 8, 23, .08);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg: #0b1220;
        --bg-grad: radial-gradient(1200px 600px at 10% -10%, #1d2a4e75, transparent 60%),
                   radial-gradient(800px 400px at 110% 10%, #4e2a1d75, transparent 60%);
        --card: #0f172a;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --border: #233044;
        --accent: #60a5fa;
        --accent-600: #3b82f6;
        --accent-700: #2563eb;
        --ring: #60a5fa;
        --shadow: 0 12px 36px rgba(0,0,0,.35);
      }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      line-height: 1.45;
      color: var(--text);
      background: var(--bg);
      background-image: var(--bg-grad);
    }

    .wrap { max-width: 980px; margin: 32px auto; padding: 0 16px; }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      box-shadow: var(--shadow);
      backdrop-filter: saturate(120%) blur(4px);
    }

    header h1 { font-size: 1.35rem; margin: 0 0 6px; letter-spacing: -.01em; }
    .subtle { color: var(--muted); font-size: .95rem; margin-bottom: 18px; }

    fieldset {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      margin: 16px 0;
      background: linear-gradient(180deg, rgba(148,163,184,.06), transparent 60%);
    }
    legend { font-weight: 700; padding: 0 10px; font-size: .98rem; }
    legend::after{
      content: ""; display: inline-block; width: 8px; height: 8px; margin-left: 8px; border-radius: 999px;
      background: var(--accent); box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent) 20%, transparent);
    }

    label { display: inline-block; margin: 8px 0 6px; font-weight: 600; }
    .row { display: grid; grid-template-columns: 1fr; gap: 10px; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .inline { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .inline.nowrap { flex-wrap: nowrap; }

    input[type="text"], input[type="email"], select {
      width: 100%; max-width: 560px; padding: 10px 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--card); color: var(--text);
      outline: none; transition: border-color .15s ease, box-shadow .15s ease, transform .06s ease; box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    }
    input[type="text"]:focus, input[type="email"]:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px color-mix(in oklab, var(--ring) 45%, transparent); }
    input.small { width: 120px; }

    .help { font-size: .9rem; color: var(--muted); margin-top: 2px; }

    .actions { margin-top: 18px; display: flex; gap: 12px; align-items: center; border-top: 1px dashed var(--border); padding-top: 16px; }
    button {
      padding: 10px 16px; border-radius: 12px; border: 1px solid var(--border); background: var(--card);
      cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-weight: 600;
      transition: transform .06s ease, box-shadow .15s ease, background .2s ease, border-color .15s ease;
    }
    button.primary { background: linear-gradient(180deg, var(--accent), var(--accent-600)); color: white; border-color: transparent; box-shadow: 0 6px 16px rgba(37,99,235,.35); }
    button.primary:hover { background: linear-gradient(180deg, var(--accent-600), var(--accent-700)); transform: translateY(-0.5px); }

    .table-like { border: 1px dashed var(--border); border-radius: 12px; padding: 12px; }
    .table-row { display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 10px; }
    .table-row .remove { align-self: center; }
    .muted { color: var(--muted); font-size: .9rem; }

    [hidden] { display: none !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Solicitud de Visa de No Inmigrante en línea (DS-160)</h1>
        <div class="subtle">Sección: <strong>Dirección y teléfono</strong> · ID de solicitud <strong>AA00F3A013</strong></div>
      </header>

      <form id="ds160-contact" action="#" method="post">
        <fieldset>
          <legend>Domicilio</legend>

          <div class="row">
            <label for="APP_ADDR_LN1">Calle (línea 1)</label>
            <input type="text" id="APP_ADDR_LN1" name="APP_ADDR_LN1" maxlength="40" required value="ALLENDE 211" />
          </div>

          <div class="row">
            <div class="inline" style="gap:8px;">
              <label for="APP_ADDR_LN2" style="margin:0;">Calle (línea 2)</label>
              <span class="muted">*Opcional</span>
            </div>
            <input type="text" id="APP_ADDR_LN2" name="APP_ADDR_LN2" maxlength="40" />
          </div>

          <div class="grid-2">
            <div>
              <label for="APP_ADDR_CITY">Ciudad</label>
              <input type="text" id="APP_ADDR_CITY" name="APP_ADDR_CITY" maxlength="20" required value="MAGDALENA" />
            </div>

            <div>
              <label for="APP_ADDR_STATE">Estado/Provincia</label>
              <div class="inline nowrap">
                <input type="text" id="APP_ADDR_STATE" name="APP_ADDR_STATE" maxlength="20" value="SONORA" />
                <label style="font-weight:400;">
                  <input type="checkbox" id="APP_ADDR_STATE_NA_cb"> No aplica
                </label>
                <input type="hidden" id="APP_ADDR_STATE_NA" name="APP_ADDR_STATE_NA" value="N">
              </div>
            </div>
          </div>

          <div class="grid-2">
            <div>
              <label for="APP_ADDR_POSTAL_CD">Código postal / Zona</label>
              <div class="inline nowrap">
                <input type="text" id="APP_ADDR_POSTAL_CD" name="APP_ADDR_POSTAL_CD" maxlength="10" inputmode="numeric" value="84600" />
                <label style="font-weight:400;">
                  <input type="checkbox" id="APP_ADDR_POSTAL_CD_NA_cb"> No aplica
                </label>
                <input type="hidden" id="APP_ADDR_POSTAL_CD_NA" name="APP_ADDR_POSTAL_CD_NA" value="N">
              </div>
            </div>

            <div>
              <label for="APP_ADDR_COUNTRY">País/Región</label>
              <select id="APP_ADDR_COUNTRY" name="APP_ADDR_COUNTRY" required></select>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Dirección postal</legend>

          <div class="row">
            <label>¿Tu dirección postal es la misma que tu dirección de domicilio?</label>
            <div class="inline" role="radiogroup" aria-label="Dirección postal igual a domicilio">
              <label style="font-weight:400;"><input type="radio" name="MAILING_ADDR_SAME_AS_APP_ADDR" id="MAIL_SAME_Y" value="Y" required checked> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="MAILING_ADDR_SAME_AS_APP_ADDR" id="MAIL_SAME_N" value="N"> No</label>
            </div>
          </div>

          <div id="mailingSection" class="row" hidden>
            <div class="row">
              <label for="MAIL_ADDR_LN1">Calle (línea 1) — dirección postal</label>
              <input type="text" id="MAIL_ADDR_LN1" name="MAIL_ADDR_LN1" maxlength="40" />
            </div>
            <div class="row">
              <div class="inline" style="gap:8px;">
                <label for="MAIL_ADDR_LN2" style="margin:0;">Calle (línea 2)</label>
                <span class="muted">*Opcional</span>
              </div>
              <input type="text" id="MAIL_ADDR_LN2" name="MAIL_ADDR_LN2" maxlength="40" />
            </div>
            <div class="grid-2">
              <div>
                <label for="MAIL_ADDR_CITY">Ciudad</label>
                <input type="text" id="MAIL_ADDR_CITY" name="MAIL_ADDR_CITY" maxlength="20" />
              </div>
              <div>
                <label for="MAIL_ADDR_STATE">Estado/Provincia</label>
                <div class="inline nowrap">
                  <input type="text" id="MAIL_ADDR_STATE" name="MAIL_ADDR_STATE" maxlength="20" />
                  <label style="font-weight:400;">
                    <input type="checkbox" id="MAIL_ADDR_STATE_NA_cb"> No aplica
                  </label>
                  <input type="hidden" id="MAIL_ADDR_STATE_NA" name="MAIL_ADDR_STATE_NA" value="N">
                </div>
              </div>
            </div>
            <div class="grid-2">
              <div>
                <label for="MAIL_ADDR_POSTAL_CD">Código postal / Zona</label>
                <div class="inline nowrap">
                  <input type="text" id="MAIL_ADDR_POSTAL_CD" name="MAIL_ADDR_POSTAL_CD" maxlength="10" inputmode="numeric" />
                  <label style="font-weight:400;">
                    <input type="checkbox" id="MAIL_ADDR_POSTAL_CD_NA_cb"> No aplica
                  </label>
                  <input type="hidden" id="MAIL_ADDR_POSTAL_CD_NA" name="MAIL_ADDR_POSTAL_CD_NA" value="N">
                </div>
              </div>
              <div>
                <label for="MAIL_ADDR_COUNTRY">País/Región</label>
                <select id="MAIL_ADDR_COUNTRY" name="MAIL_ADDR_COUNTRY"></select>
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Teléfono</legend>

          <div class="row">
            <label for="APP_HOME_TEL">Número de teléfono principal</label>
            <input type="text" id="APP_HOME_TEL" name="APP_HOME_TEL" maxlength="15" inputmode="numeric" required value="63232564776" />
          </div>

          <div class="row">
            <label for="APP_MOBILE_TEL">Número de teléfono secundario</label>
            <div class="inline nowrap">
              <input type="text" id="APP_MOBILE_TEL" name="APP_MOBILE_TEL" maxlength="15" inputmode="numeric" />
              <label style="font-weight:400;">
                <input type="checkbox" id="APP_MOBILE_TEL_NA_cb" checked> No aplica
              </label>
              <input type="hidden" id="APP_MOBILE_TEL_NA" name="APP_MOBILE_TEL_NA" value="Y">
            </div>
          </div>

          <div class="row">
            <label for="APP_BUS_TEL">Número de teléfono del trabajo</label>
            <div class="inline nowrap">
              <input type="text" id="APP_BUS_TEL" name="APP_BUS_TEL" maxlength="15" inputmode="numeric" />
              <label style="font-weight:400;">
                <input type="checkbox" id="APP_BUS_TEL_NA_cb" checked> No aplica
              </label>
              <input type="hidden" id="APP_BUS_TEL_NA" name="APP_BUS_TEL_NA" value="Y">
            </div>
          </div>

          <div class="help">
            Debe proporcionar un número de teléfono principal. Puede ser fijo o celular. Si cuenta con otro número, puede registrarlo como secundario.
          </div>

          <div class="row" style="margin-top:10px;">
            <label>¿Ha usado otros números de teléfono en los últimos cinco (5) años?</label>
            <div class="inline" role="radiogroup" aria-label="Otros teléfonos últimos 5 años">
              <label style="font-weight:400;"><input type="radio" name="AddPhone" id="AddPhoneY" value="Y"> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="AddPhone" id="AddPhoneN" value="N" checked> No</label>
            </div>
          </div>

          <div id="otherPhones" class="table-like" hidden>
            <div class="table-row">
              <div>
                <label>Número</label>
                <input type="text" class="phone-other" name="OTHER_PHONE[]" maxlength="15" inputmode="numeric" />
              </div>
              <div>
                <label>Descripción (opcional)</label>
                <input type="text" name="OTHER_PHONE_DESC[]" maxlength="40" />
              </div>
              <button type="button" class="remove" aria-label="Eliminar teléfono" title="Eliminar">✕</button>
            </div>
            <button type="button" id="btnAddPhone">Agregar otro</button>
          </div>
        </fieldset>

        <fieldset>
          <legend>Correo electrónico</legend>

          <div class="row">
            <label for="APP_EMAIL_ADDR">Dirección de correo electrónico</label>
            <input type="email" id="APP_EMAIL_ADDR" name="APP_EMAIL_ADDR" maxlength="50" required value="mayddress@gmail.com" />
            <div class="help">(ej., nombre@dominio.com) — Debe proporcionar un correo seguro al que tenga acceso.</div>
          </div>

          <div class="row" style="margin-top:10px;">
            <label>¿Ha usado otras direcciones de correo electrónico en los últimos cinco (5) años?</label>
            <div class="inline" role="radiogroup" aria-label="Otros correos últimos 5 años">
              <label style="font-weight:400;"><input type="radio" name="AddEmail" id="AddEmailY" value="Y"> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="AddEmail" id="AddEmailN" value="N" checked> No</label>
            </div>
          </div>

          <div id="otherEmails" class="table-like" hidden>
            <div class="table-row">
              <div>
                <label>Correo</label>
                <input type="email" class="email-other" name="OTHER_EMAIL[]" maxlength="50" />
              </div>
              <div>
                <label>Descripción (opcional)</label>
                <input type="text" name="OTHER_EMAIL_DESC[]" maxlength="40" />
              </div>
              <button type="button" class="remove" aria-label="Eliminar correo" title="Eliminar">✕</button>
            </div>
            <button type="button" id="btnAddEmail">Agregar otro</button>
          </div>
        </fieldset>

        <fieldset>
          <legend>Redes sociales</legend>

          <div class="row">
            <label>¿Tiene presencia en redes sociales?</label>
            <div class="help">Seleccione la(s) plataforma(s) que haya usado en los últimos cinco (5) años e indique su identificador (usuario/handle). No proporcione contraseñas.</div>
          </div>

          <div id="socialTable" class="table-like">
            <div class="table-row social-row">
              <div>
                <label>Plataforma</label>
                <select class="social-platform" name="SOCIAL_PLATFORM[]">
                  <option value="NONE" selected>NINGUNA</option>
                  <option value="ASKF">ASK.FM</option>
                  <option value="DUBN">DOUBAN</option>
                  <option value="FCBK">FACEBOOK</option>
                  <option value="FLKR">FLICKR</option>
                  <option value="GOGL">GOOGLE+</option>
                  <option value="INST">INSTAGRAM</option>
                  <option value="LINK">LINKEDIN</option>
                  <option value="MYSP">MYSPACE</option>
                  <option value="PTST">PINTEREST</option>
                  <option value="QZNE">QZONE (QQ)</option>
                  <option value="RDDT">REDDIT</option>
                  <option value="SWBO">SINA WEIBO</option>
                  <option value="TWBO">TENCENT WEIBO</option>
                  <option value="TUMB">TUMBLR</option>
                  <option value="TWIT">TWITTER/X</option>
                  <option value="TWOO">TWOO</option>
                  <option value="VINE">VINE</option>
                  <option value="VKON">VKONTAKTE (VK)</option>
                  <option value="YUKU">YOUKU</option>
                  <option value="YTUB">YOUTUBE</option>
                </select>
              </div>
              <div>
                <label>Identificador</label>
                <input type="text" class="social-ident" name="SOCIAL_IDENT[]" maxlength="50" disabled />
              </div>
              <button type="button" class="remove" aria-label="Eliminar fila" title="Eliminar">✕</button>
            </div>
            <button type="button" id="btnAddSocial">Agregar otra</button>
          </div>

          <div class="row" style="margin-top:10px;">
            <label>¿Desea proporcionar información sobre su presencia en otros sitios o aplicaciones que haya usado en los últimos cinco (5) años para crear o compartir contenido?</label>
            <div class="inline" role="radiogroup" aria-label="Otros sitios o apps">
              <label style="font-weight:400;"><input type="radio" name="AddSocial" id="AddSocialY" value="Y"> Sí</label>
              <label style="font-weight:400;"><input type="radio" name="AddSocial" id="AddSocialN" value="N" checked> No</label>
            </div>
          </div>

          <div id="otherSocials" class="table-like" hidden>
            <div class="table-row">
              <div>
                <label>Sitio/App</label>
                <input type="text" name="OTHER_SOCIAL_SITE[]" maxlength="40" />
              </div>
              <div>
                <label>Usuario o URL</label>
                <input type="text" name="OTHER_SOCIAL_IDENT[]" maxlength="80" />
              </div>
              <button type="button" class="remove" aria-label="Eliminar sitio" title="Eliminar">✕</button>
            </div>
            <button type="button" id="btnAddOtherSocial">Agregar otro</button>
          </div>

          <div class="help">
            Puede incluir aplicaciones y sitios donde colabora, comparte información o interactúa con otras personas. No incluya cuentas de uso compartido de una empresa u organización.
          </div>
        </fieldset>

        <div class="actions">
          <button type="button" id="backBtn">Regresar: Viajes previos a EE. UU.</button>
          <button type="button" id="nextBtn" class="primary">Siguiente: Pasaporte</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ---------- Constantes de navegación ----------
    const NEXT_URL = new URL('trabajo_educacion_7.html', window.location.href).href;
    const BACK_URL = new URL('viajes-previos-eeuu_5.html', window.location.href).href;

    // ---------- Persistencia ----------
    const STORAGE_PREFIX = 'ds160:';
    const FORM_ID = 'ds160-contact';
    function storageKey(field) {
      const idOrName = field.type === 'radio' ? field.name : (field.id || field.name);
      return STORAGE_PREFIX + FORM_ID + ':' + idOrName + (field.type==='radio' ? '' : '');
    }
    function saveField(field) {
      try {
        if (field.type === 'radio') {
          if (field.checked) localStorage.setItem(storageKey(field), field.value);
        } else if (field.type === 'checkbox') {
          localStorage.setItem(storageKey(field), field.checked ? '1' : '0');
        } else {
          localStorage.setItem(storageKey(field), field.value);
        }
      } catch(e) {}
    }
    function restoreField(field) {
      try {
        const key = STORAGE_PREFIX + FORM_ID + ':' + (field.type==='radio' ? field.name : (field.id || field.name));
        const v = localStorage.getItem(key);
        if (v == null) return;
        if (field.type === 'radio') {
          field.checked = (field.value === v);
        } else if (field.type === 'checkbox') {
          field.checked = (v === '1');
        } else {
          field.value = v;
        }
      } catch(e) {}
    }
    function autosave(form) {
      form.addEventListener('input', (e) => {
        const t = e.target;
        if (!(t instanceof HTMLElement)) return;
        if (t.matches('input,select,textarea')) saveField(t);
      }, true);
      form.addEventListener('change', (e) => {
        const t = e.target;
        if (!(t instanceof HTMLElement)) return;
        if (t.matches('input,select,textarea')) saveField(t);
      }, true);
    }
    function restoreForm(form) {
      const fields = form.querySelectorAll('input,select,textarea');
      fields.forEach(f => restoreField(f));
    }

    // ---------- Utilidades ----------
    function digitsOnly(el, max) { el.value = el.value.replace(/\D/g,'').slice(0, max); }
    function toggleNA(textInput, checkbox, hiddenField){
      const update = () => {
        if (checkbox.checked) {
          textInput.disabled = true; textInput.value = ''; textInput.setCustomValidity('');
          if (hiddenField) hiddenField.value = 'Y';
        } else {
          textInput.disabled = false;
          if (hiddenField) hiddenField.value = 'N';
        }
      };
      checkbox.addEventListener('change', update);
      update();
      return update;
    }
    function toggleSectionByRadios(radioY, radioN, section, requiredEls = []) {
      const update = () => {
        const show = radioY.checked;
        section.hidden = !show;
        requiredEls.forEach(el => { el.required = show; if (!show) { el.value = ''; el.setCustomValidity(''); } });
      };
      [radioY, radioN].forEach(r => r && r.addEventListener('change', update));
      update();
      return update;
    }
    function digitsWiring(el, max=15){ el && el.addEventListener('input', () => digitsOnly(el, max)); }

    // ---------- Países ----------
    const COUNTRIES = [
      "- Seleccione -",
      "AFGANISTÁN","ALBANIA","ALEMANIA","ANDORRA","ANGOLA","ANTIGUA Y BARBUDA",
      "ARGENTINA","ARUBA","AUSTRALIA","AUSTRIA","AZERBAIYÁN",
      "BAHAMAS","BANGLADESH","BARBADOS","BÉLGICA","BELICE","BENÍN","BERMUDA","BOLIVIA","BOSNIA Y HERZEGOVINA","BOTSUANA","BRASIL","BRUNEI","BULGARIA",
      "CABO VERDE","CAMBOYA","CAMERÚN","CANADÁ","CHILE","CHINA","COLOMBIA","COMORAS","COREA DEL SUR","COSTA RICA","CROACIA","CUBA","CURAZAO",
      "DINAMARCA","DOMINICA","ECUADOR","EGIPTO","EL SALVADOR","EMIRATOS ÁRABES UNIDOS","ESLOVAQUIA","ESLOVENIA","ESPAÑA","ESTADOS UNIDOS","ESTONIA","ESWATINI","ETIOPÍA",
      "FILIPINAS","FINLANDIA","FRANCIA",
      "GAZA","GEORGIA","GHANA","GIBRALTAR","GRANADA","GRECIA","GUADALUPE","GUATEMALA","GUYANA",
      "HAITÍ","HONDURAS","HONG KONG","HUNGRÍA",
      "INDIA","INDONESIA","IRAK","IRÁN","IRLANDA","ISLANDIA","ISRAEL","ITALIA",
      "JAMAICA","JAPÓN","JORDANIA",
      "KAZAJISTÁN","KENIA","KIRGUISTÁN","KIRIBATI","KOSOVO","KUWAIT",
      "LAOS","LETONIA","LÍBANO","LIBERIA","LIBIA","LIECHTENSTEIN","LITUANIA","LUXEMBURGO",
      "MACAO","MACEDONIA DEL NORTE","MADAGASCAR","MALASIA","MALAWI","MALDIVAS","MALTA","MARRUECOS","MARTINICA","MAURICIO","MAURITANIA","MÉXICO","MICRONESIA","MOLDAVIA","MÓNACO","MONGOLIA","MONTENEGRO","MONTSERRAT","MOZAMBIQUE",
      "NAMIBIA","NAURU","NEPAL","NICARAGUA","NÍGER","NIGERIA","NIUE","NORUEGA","NUEVA CALEDONIA","NUEVA ZELANDA",
      "OMÁN",
      "PAÍSES BAJOS","PAKISTÁN","PALAOS","PANAMÁ","PAPÚA NUEVA GUINEA","PARAGUAY","PERÚ","POLONIA","PORTUGAL","PUERTO RICO","QATAR",
      "REINO UNIDO","REPÚBLICA CHECA","REPÚBLICA DOMINICANA","REUNIÓN","RUMANÍA","RUSIA","RUANDA",
      "SAMOA","SAN MARINO","SANTA ELENA","SANTA LUCÍA","SANTO TOMÉ Y PRÍNCIPE","SAN VICENTE Y LAS GRANADINAS","SENEGAL","SERBIA","SEYCHELLES","SIERRA LEONA","SINGAPUR","SIRIA","SRI LANKA","SUDÁFRICA","SUDÁN","SUDÁN DEL SUR","SUECIA","SUIZA",
      "TAILANDIA","TAIWÁN","TANZANIA","TIMOR-LESTE","TOGO","TOKELAU","TONGA","TRINIDAD Y TOBAGO","TÚNEZ","TURKMENISTÁN","TURQUÍA","TURCOS Y CAICOS","TUVALU",
      "UCRANIA","UGANDA","URUGUAY","UZBEKISTÁN",
      "VANUATU","VENEZUELA","VIETNAM",
      "WALLIS Y FUTUNA","YEMEN","ZAMBIA","ZIMBABUE"
    ];
    function fillCountrySelect(selectEl, defaultName = "MÉXICO") {
      selectEl.innerHTML = "";
      COUNTRIES.forEach((name, i) => {
        const opt = document.createElement('option');
        opt.value = i === 0 ? "" : name;
        opt.textContent = name;
        if (name === defaultName) opt.selected = true;
        selectEl.appendChild(opt);
      });
    }

    // ---------- Clonado de filas dinámicas ----------
    function wireRemoveButtons(container){
      container.querySelectorAll('button.remove').forEach(btn => {
        btn.onclick = () => {
          const row = btn.closest('.table-row');
          const rows = container.querySelectorAll('.table-row');
          if (rows.length > 1) row.remove();
        };
      });
    }
    function addPhoneRow(){
      const c = document.getElementById('otherPhones');
      const first = c.querySelector('.table-row');
      const clone = first.cloneNode(true);
      clone.querySelectorAll('input').forEach(i=>{ i.value=''; });
      c.insertBefore(clone, c.querySelector('#btnAddPhone'));
      wireRemoveButtons(c);
      clone.querySelectorAll('input.phone-other').forEach(el => digitsWiring(el));
    }
    function addEmailRow(){
      const c = document.getElementById('otherEmails');
      const first = c.querySelector('.table-row');
      const clone = first.cloneNode(true);
      clone.querySelectorAll('input').forEach(i=>{ i.value=''; });
      c.insertBefore(clone, c.querySelector('#btnAddEmail'));
      wireRemoveButtons(c);
    }
    function addSocialRow(){
      const c = document.getElementById('socialTable');
      const first = c.querySelector('.social-row');
      const clone = first.cloneNode(true);
      clone.querySelector('.social-platform').selectedIndex = 0;
      const ident = clone.querySelector('.social-ident');
      ident.value = ''; ident.disabled = true; ident.required = false;
      c.insertBefore(clone, c.querySelector('#btnAddSocial'));
      wireRemoveButtons(c);
      wireSocialPlatform(clone.querySelector('.social-platform'), ident);
    }
    function addOtherSocialRow(){
      const c = document.getElementById('otherSocials');
      const first = c.querySelector('.table-row');
      const clone = first.cloneNode(true);
      clone.querySelectorAll('input').forEach(i=>{ i.value=''; });
      c.insertBefore(clone, c.querySelector('#btnAddOtherSocial'));
      wireRemoveButtons(c);
    }

    function wireSocialPlatform(selectEl, identEl){
      const update = () => {
        const none = (selectEl.value === 'NONE');
        identEl.disabled = none;
        identEl.required = !none;
        if (none) { identEl.value=''; identEl.setCustomValidity(''); }
      };
      selectEl.addEventListener('change', update);
      update();
    }

    // ---------- Inicio ----------
    const form = document.getElementById(FORM_ID);

    // Países
    fillCountrySelect(document.getElementById('APP_ADDR_COUNTRY'), 'MÉXICO');
    fillCountrySelect(document.getElementById('MAIL_ADDR_COUNTRY'), 'MÉXICO');

    // Restaura antes de cablear
    restoreForm(form);

    // NA toggles + hidden sync
    const updHomeStateNA = toggleNA(
      document.getElementById('APP_ADDR_STATE'),
      document.getElementById('APP_ADDR_STATE_NA_cb'),
      document.getElementById('APP_ADDR_STATE_NA')
    );
    const updHomeZipNA = toggleNA(
      document.getElementById('APP_ADDR_POSTAL_CD'),
      document.getElementById('APP_ADDR_POSTAL_CD_NA_cb'),
      document.getElementById('APP_ADDR_POSTAL_CD_NA')
    );
    const updMobileNA = toggleNA(
      document.getElementById('APP_MOBILE_TEL'),
      document.getElementById('APP_MOBILE_TEL_NA_cb'),
      document.getElementById('APP_MOBILE_TEL_NA')
    );
    const updBusNA = toggleNA(
      document.getElementById('APP_BUS_TEL'),
      document.getElementById('APP_BUS_TEL_NA_cb'),
      document.getElementById('APP_BUS_TEL_NA')
    );
    const updMailStateNA = toggleNA(
      document.getElementById('MAIL_ADDR_STATE'),
      document.getElementById('MAIL_ADDR_STATE_NA_cb'),
      document.getElementById('MAIL_ADDR_STATE_NA')
    );
    const updMailZipNA = toggleNA(
      document.getElementById('MAIL_ADDR_POSTAL_CD'),
      document.getElementById('MAIL_ADDR_POSTAL_CD_NA_cb'),
      document.getElementById('MAIL_ADDR_POSTAL_CD_NA')
    );

    // Radios -> secciones
    const refreshMailing = toggleSectionByRadios(
      document.getElementById('MAIL_SAME_Y'),
      document.getElementById('MAIL_SAME_N'),
      document.getElementById('mailingSection'),
      [document.getElementById('MAIL_ADDR_LN1'), document.getElementById('MAIL_ADDR_CITY')]
    );
    const refreshOtherPhones = toggleSectionByRadios(
      document.getElementById('AddPhoneY'),
      document.getElementById('AddPhoneN'),
      document.getElementById('otherPhones'),
      []
    );
    const refreshOtherEmails = toggleSectionByRadios(
      document.getElementById('AddEmailY'),
      document.getElementById('AddEmailN'),
      document.getElementById('otherEmails'),
      []
    );
    const refreshOtherSocials = toggleSectionByRadios(
      document.getElementById('AddSocialY'),
      document.getElementById('AddSocialN'),
      document.getElementById('otherSocials'),
      []
    );

    // Números solo dígitos
    ['APP_HOME_TEL','APP_MOBILE_TEL','APP_BUS_TEL','APP_ADDR_POSTAL_CD','MAIL_ADDR_POSTAL_CD'].forEach(id=>{
      const el = document.getElementById(id);
      digitsWiring(el, id.includes('POSTAL') ? 10 : 15);
    });

    // Social platform wiring
    document.querySelectorAll('.social-row').forEach(row=>{
      const sel = row.querySelector('.social-platform');
      const ident = row.querySelector('.social-ident');
      wireSocialPlatform(sel, ident);
    });

    // Botones agregar/eliminar
    wireRemoveButtons(document.getElementById('otherPhones'));
    wireRemoveButtons(document.getElementById('otherEmails'));
    wireRemoveButtons(document.getElementById('socialTable'));
    wireRemoveButtons(document.getElementById('otherSocials'));
    document.getElementById('btnAddPhone').onclick = addPhoneRow;
    document.getElementById('btnAddEmail').onclick = addEmailRow;
    document.getElementById('btnAddSocial').onclick = addSocialRow;
    document.getElementById('btnAddOtherSocial').onclick = addOtherSocialRow;

    // Persistencia
    autosave(form);

    // Recalcular UI tras restaurar
    updHomeStateNA(); updHomeZipNA(); updMobileNA(); updBusNA(); updMailStateNA(); updMailZipNA();
    refreshMailing(); refreshOtherPhones(); refreshOtherEmails(); refreshOtherSocials();

    // Navegación
    document.getElementById('backBtn').addEventListener('click', () => {
      form.querySelectorAll('input,select,textarea').forEach(saveField);
      window.location.assign(BACK_URL);
    });
    document.getElementById('nextBtn').addEventListener('click', () => {
      if (!form.checkValidity()) {
        form.reportValidity();
        const firstInvalid = form.querySelector(':invalid');
        if (firstInvalid) firstInvalid.scrollIntoView({behavior:'smooth', block:'center'});
        return;
      }
      form.querySelectorAll('input,select,textarea').forEach(saveField);
      window.location.assign(NEXT_URL);
    });

  </script>
</body>
</html>
